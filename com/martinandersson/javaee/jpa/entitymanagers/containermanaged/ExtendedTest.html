<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_92) on Fri Aug 18 15:52:09 CEST 2017 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>ExtendedTest (Java EE Concepts 1.0.0-SNAPSHOT Test API)</title>
<meta name="date" content="2017-08-18">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ExtendedTest (Java EE Concepts 1.0.0-SNAPSHOT Test API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ExtendedTest.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/AbstractContainerManagedEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers.containermanaged"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/TransactionScopedTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers.containermanaged"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html" target="_top">Frames</a></li>
<li><a href="ExtendedTest.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.martinandersson.javaee.jpa.entitymanagers.containermanaged</div>
<h2 title="Class ExtendedTest" class="title">Class ExtendedTest</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/AbstractJTAEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers">com.martinandersson.javaee.jpa.entitymanagers.AbstractJTAEntityManagerTest</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/AbstractContainerManagedEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers.containermanaged">com.martinandersson.javaee.jpa.entitymanagers.containermanaged.AbstractContainerManagedEntityManagerTest</a></li>
<li>
<ul class="inheritance">
<li>com.martinandersson.javaee.jpa.entitymanagers.containermanaged.ExtendedTest</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">ExtendedTest</span>
extends <a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/AbstractContainerManagedEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers.containermanaged">AbstractContainerManagedEntityManagerTest</a></pre>
<div class="block">The persistence context of an container-managed entity manager may be
 extended (for application-managed entity managers, the persistence context
 is always extended).<p>
 
 Only <code>@Stateful</code> EJB:s may use a container-managed entity manager with
 an extended persistence context<sup>1</sup>.<p>
 
 An extended persistence context is not bound to one specific transaction
 (context survive transaction boundaries). The context exist "from the time
 the EntityManager instance is created until it is closed"<sup>2</sup>.<p>
 
 Speaking of container-managed entity managers, then the context will be bound
 to the <code>@Stateful</code> owner and the context is destroyed when the bean is
 destroyed.<p>
 
 The extended persistence context may propagate to beans that use a
 transaction-scoped entity manager, effectively making the transaction-scoped
 persistence context of type extended. See
 <a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#extendedPersistenceContextPropagateToTransactional--">extendedPersistenceContextPropagateToTransactional()</a>.<p>
 
 The extended persistence context itself can not be inherited from other
 beans, whether or not the origin uses a transactional-scoped or extended
 persistence context. It is "created new" so to speak. But there is one
 exception to this rule. It is possible for a stateful bean that uses an
 extended persistence context to inherit an extended persistence context from
 another stateful bean if the latter bean is initialized within the scope of
 the former bean<sup>3</sup>.<p>
 
 
 
 <h3>Usage of the entity manager outside a transaction</h3>
 
 JPA 2.1, section "3.1.1 EntityManager Interface":
 <pre><code>
 
     The find method (provided it is invoked without a lock or invoked with
     LockModeType.NONE) and the getReference method are not required to be
     invoked within a transaction. [..] if an entity manager with an extended
     persistence context is used, they will be managed.
 
 </code></pre>
 
 JPA 2.1, section 3.3 "Persistence Context Lifetime and Synchronization Type":
 <pre><code>
 
     When an EntityManager with an extended persistence context is used, the
     persist, remove, merge, and refresh operations can be called regardless
     of whether a transaction is active. The effects of these operations will
     be committed to the database when the extended persistence context is
     enlisted in a transaction and the transaction commits.
 
 </code></pre>
 
 
 
 
 <h4>Note 1</h4>
 
 This applies only for container-managed entity managers that use an extended
 persistence context. Application managed entity managers can be used anywhere
 and their persistence context is extended.
 
 
 <h4>Note 2</h4>
 
 See JPA 2.1, section "3.3 Persistence Context Lifetime and Synchronization
 Type".
 
 
 <h4>Note 3</h4>
 See JPA 2.1, section 7.6.3 "Container-managed Extended Persistence Context"</div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>Martin Andersson (webmaster at martinandersson.com)</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#ExtendedTest--">ExtendedTest</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#extendedPersistenceContextFlushOnEveryTransactionCommit--">extendedPersistenceContextFlushOnEveryTransactionCommit</a></span>()</code>
<div class="block">A container-managed entity manager with extended persistence context can
 be used with a <code>@Stateful</code>, which kind of is the purpose of this
 entity manager configuration.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#extendedPersistenceContextPropagateToTransactional--">extendedPersistenceContextPropagateToTransactional</a></span>()</code>
<div class="block">Continuing the last test, is the other way around possible? Can a bean
 that uses a transaction-scoped persistence context inherit an extended
 context?</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#extendedPersistenceContextWithoutTransactions_changesLost--">extendedPersistenceContextWithoutTransactions_changesLost</a></span>()</code>
<div class="block">So what if the <code>@Remove</code> also did not use a transaction? Is changes
 flushed to database or not? Do the application crash?</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#extendedPersistenceWithDelayedFlush--">extendedPersistenceWithDelayedFlush</a></span>()</code>
<div class="block">Bean <code>StatefulWithExtended2</code> suspend inbound transactions during
 casual business operations until the <code>@Remove</code> call which requires
 a transaction (i.e., transaction will be started and used if no one is
 active).</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>protected <a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/EntityManagerExposer.html" title="interface in com.martinandersson.javaee.jpa.entitymanagers">EntityManagerExposer</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#getBeanBeingTested--">getBeanBeingTested</a></span>()</code>
<div class="block">Returns the target bean that offer an exposed <code>EntityManager</code>.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#persistenceContextCanNotPropagateIntoExtended--">persistenceContextCanNotPropagateIntoExtended</a></span>()</code>
<div class="block">JPA 2.1 specification, section "7.6.4.1 Requirements for Persistence
 Context Propagation":</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#singletonEJBCanNotUseExtended--">singletonEJBCanNotUseExtended</a></span>()</code>
<div class="block">Same results as <a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#statelessEJBCanNotUseExtended--">statelessEJBCanNotUseExtended()</a>.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#statelessEJBCanNotUseExtended--">statelessEJBCanNotUseExtended</a></span>()</code>
<div class="block">Continuing on the last test case, what happens if a <code>@Stateless</code>
 use a container-managed entity manager with extended persistence
 context?</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#transactionalCDIBeanCanNotUseExtended--">transactionalCDIBeanCanNotUseExtended</a></span>()</code>
<div class="block">Only a <code>@Stateful</code> EJB is supposed to be able to use a
 container-managed entity manager with an extended persistence context.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.com.martinandersson.javaee.jpa.entitymanagers.containermanaged.AbstractContainerManagedEntityManagerTest">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.martinandersson.javaee.jpa.entitymanagers.containermanaged.<a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/AbstractContainerManagedEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers.containermanaged">AbstractContainerManagedEntityManagerTest</a></h3>
<code><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/AbstractContainerManagedEntityManagerTest.html#containerManagedEntityManagerCanNotBeClosedByApplication--">containerManagedEntityManagerCanNotBeClosedByApplication</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.com.martinandersson.javaee.jpa.entitymanagers.AbstractJTAEntityManagerTest">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.martinandersson.javaee.jpa.entitymanagers.<a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/AbstractJTAEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers">AbstractJTAEntityManagerTest</a></h3>
<code><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/AbstractJTAEntityManagerTest.html#JTAEntityManagerMustNotUseResourceLocalTransaction--">JTAEntityManagerMustNotUseResourceLocalTransaction</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ExtendedTest--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ExtendedTest</h4>
<pre>public&nbsp;ExtendedTest()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="transactionalCDIBeanCanNotUseExtended--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>transactionalCDIBeanCanNotUseExtended</h4>
<pre>public&nbsp;void&nbsp;transactionalCDIBeanCanNotUseExtended()</pre>
<div class="block">Only a <code>@Stateful</code> EJB is supposed to be able to use a
 container-managed entity manager with an extended persistence context.<p>
 
 EJB 3.2 specification, section "11.11.1.1 Injection of Persistence
 Context References":
 <pre><code>
 
     References to container-managed entity managers with extended
     persistence contexts can only be injected into stateful session beans.
 
 </code></pre>
 
 JPA 2.1 specification, section "7.6.3 Container-managed Extended
 Persistence Context":
 <pre><code>
 
     A container-managed extended persistence context can only be
     initiated within the scope of a stateful session bean. It exists from
     the point at which the stateful session bean that declares a
     dependency on an entity manager of type
     PersistenceContextType.EXTENDED is created, and is said to be bound
     to the stateful session bean.
 
 </code></pre>
 
 So what happens when a <code>@Transactional</code> CDI bean use a
 container-managed entity manager with extended persistence context?<p>
 
 <strong>GlassFish 4.1</strong> crash during runtime and will not survive
 the call to our <code>@Transactional</code> bean. Exception thrown is <code>javax.transaction.RollbackException</code> and no useful information at all can
 be retrieved from the log.<p>
 
 <strong>WildFly 8.1.0</strong> is even worse<sup>1</sup> and let our code
 use the <code>@Transactional</code> with no apparent limitation. The product
 will successfully be persisted.<p>
 
 This test case has been set to expect a <code>RuntimeException</code>, making
 GlassFish pass. From what I can tell, the specifications do not say
 what is supposed to happen when using this type of entity manager
 illegally.<p>
 
 
 
 <h4>Note 1</h4>
 
 By "worse", I mean that WildFly clearly brake the specification. Me
 personally, I see no harm in braking this rule. The contextual CDI bean
 is "stateful". Also see:
 <pre><code>
     https://github.com/javaee-samples/javaee7-samples/issues/238
 </code></pre>
 
 
 
 TODO: File a WildFly bug.</div>
</li>
</ul>
<a name="statelessEJBCanNotUseExtended--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>statelessEJBCanNotUseExtended</h4>
<pre>public&nbsp;void&nbsp;statelessEJBCanNotUseExtended()
                                   throws <a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></pre>
<div class="block">Continuing on the last test case, what happens if a <code>@Stateless</code>
 use a container-managed entity manager with extended persistence
 context?<p>
 
 <strong>GlassFish 4.1</strong> happily crash during runtime. This time,
 GlassFish provide more useful logging. The exception thrown is <code>java.lang.IllegalStateException</code> and it has a message:
 <pre><code>
 
     EntityManager with PersistenceContextType.EXTENDED is not supported
     for this bean type
 
 </code></pre>
 
 <strong>WildFly 8.1.0</strong>... *drum roll* also crash during runtime!
 Yaaay =) BUT! With some weird logging. Exception thrown is <code>NullPointerException</code> at <code>org.jboss.as.jpa.container.ExtendedPersistenceDeepInheritance.findExtendedPersistenceContext()</code>.<p>
 
 Still, the worrisome is that both servers crash during runtime, not
 during deployment.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></code> - hopefully not</dd>
</dl>
</li>
</ul>
<a name="singletonEJBCanNotUseExtended--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>singletonEJBCanNotUseExtended</h4>
<pre>public&nbsp;void&nbsp;singletonEJBCanNotUseExtended()
                                   throws <a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></pre>
<div class="block">Same results as <a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html#statelessEJBCanNotUseExtended--">statelessEJBCanNotUseExtended()</a>.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></code> - hopefully not</dd>
</dl>
</li>
</ul>
<a name="extendedPersistenceContextFlushOnEveryTransactionCommit--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>extendedPersistenceContextFlushOnEveryTransactionCommit</h4>
<pre>public&nbsp;void&nbsp;extendedPersistenceContextFlushOnEveryTransactionCommit()
                                                             throws <a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></pre>
<div class="block">A container-managed entity manager with extended persistence context can
 be used with a <code>@Stateful</code>, which kind of is the purpose of this
 entity manager configuration.<p>
 
 Be wary though that JTA transactions that come and go will make the
 persistence context flush his changes to the database as they commit.<p>
 
 If that is not what you want, don't use transactions until the
 <code>@Remove</code> call, demonstrated in the next test case declared after
 this one.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></code> - hopefully not</dd>
</dl>
</li>
</ul>
<a name="extendedPersistenceWithDelayedFlush--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>extendedPersistenceWithDelayedFlush</h4>
<pre>public&nbsp;void&nbsp;extendedPersistenceWithDelayedFlush()
                                         throws <a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></pre>
<div class="block">Bean <code>StatefulWithExtended2</code> suspend inbound transactions during
 casual business operations until the <code>@Remove</code> call which requires
 a transaction (i.e., transaction will be started and used if no one is
 active).<p>
 
 Effect: Nothing is flushed to database before the <code>@Remove</code> call.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></code> - hopefully not</dd>
</dl>
</li>
</ul>
<a name="extendedPersistenceContextWithoutTransactions_changesLost--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>extendedPersistenceContextWithoutTransactions_changesLost</h4>
<pre>public&nbsp;void&nbsp;extendedPersistenceContextWithoutTransactions_changesLost()
                                                               throws <a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></pre>
<div class="block">So what if the <code>@Remove</code> also did not use a transaction? Is changes
 flushed to database or not? Do the application crash?<p>
 
 JPA 2.1 specification, section "7.6.3 Container-managed Extended
 Persistence Context":
 <pre><code>
 
     The persistence context is closed by the container when the @Remove
     method of the stateful session bean completes (or the stateful
     session bean instance is otherwise destroyed).
 
 </code></pre>
 
 JPA 2.1, section "7.9.1 Container Responsibilities":
 <pre><code>
 
     The container closes the entity manager by calling
     EntityManager.close after the stateful session bean and all other
     stateful session beans that have inherited the same persistence
     context as the entity manager have been removed.
     
     [..]
 
     When EntityManager.close is invoked, the [EntityManager] provider
     should release all resources that it may have allocated after any
     outstanding transactions involving the entity manager have completed.
 </code></pre>
 
 The specification isn't that clear. But obviously, it would be really
 strange if things was  flushed/committed to the database outside a
 transaction. And as this test proves, the application won't crash but
 nothing is persisted: we "silently" lose everything.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></code> - hopefully not</dd>
</dl>
</li>
</ul>
<a name="persistenceContextCanNotPropagateIntoExtended--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>persistenceContextCanNotPropagateIntoExtended</h4>
<pre>public&nbsp;void&nbsp;persistenceContextCanNotPropagateIntoExtended()
                                                   throws <a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></pre>
<div class="block">JPA 2.1 specification, section "7.6.4.1 Requirements for Persistence
 Context Propagation":
 <pre><code>
 
     If a component is called and the JTA transaction is propagated into
     that component:
     
         If the component is a stateful session bean to which an extended
         persistence context has been bound and there is a different
         persistence context associated with the JTA transaction, an
         EJBException is thrown by the container.
 
 </code></pre>
 
 
 <strong>GlassFish 4.1</strong> results:
 
 <pre><code>
 
     javax.ejb.EJBException: There is an active transactional persistence
     context for the same EntityManagerFactory as the current stateful
     session bean's extended persistence context
 
 </code></pre>
 
 
 <strong>WildFly 8.1.0</strong> says.. a bit more:
 
 <pre><code>
 
     javax.ejb.EJBException: JBAS011437: Found extended persistence
     context in SFSB invocation call stack but that cannot be used because
     the transaction already has a transactional context associated with
     it.  This can be avoided by changing application code, either
     eliminate the extended persistence context or the transactional
     context.  See JPA spec 2.0 section 7.6.3.1.  Scoped persistence unit
     name=ExtendedTest.war#arquillian-pu, persistence context already in
     transaction =org.hibernate.jpa.internal.EntityManagerImpl@16fdcf86,
     extended persistence context =ExtendedEntityManager
     [ExtendedTest.war#arquillian-pu].
 
 </code></pre>
 
 Note that this test try to make a stateful bean, that uses an extended
 persistence context, inherit a transaction-scoped context - which is
 illegal. However, it is possible for a stateful bean that uses an
 extended context to inherit an extended persistence context from another
 stateful bean if the latter bean is initiated within the scope of the
 former bean. See section 7.6.3 "Container-managed Extended Persistence
 Context". Currently, this is not demonstrated/tested in this class.<p>
 
 TODO: Write one test that try to illegally inherit another "foreign"
 extended context, and one test that legally inherit an extended context
 according to what has just been said in the last paragraph.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></code> - hopefully not</dd>
<dd><code>javax.ejb.EJBException</code> - if all goes well</dd>
</dl>
</li>
</ul>
<a name="extendedPersistenceContextPropagateToTransactional--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>extendedPersistenceContextPropagateToTransactional</h4>
<pre>public&nbsp;void&nbsp;extendedPersistenceContextPropagateToTransactional()
                                                        throws <a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></pre>
<div class="block">Continuing the last test, is the other way around possible? Can a bean
 that uses a transaction-scoped persistence context inherit an extended
 context?<p>
 
 There's no technical reason to believe it is not possible. The
 persistence context is expected to be propagated "as usual" and as this
 test case show, that is the outcome.<p>
 
 However doable this model is, I feel it is semantically strange. The
 called bean has declared a dependency on a transaction-scoped entity
 manager (or rather, persistence context), yet what he get in this test
 case is an extended entity manager!<p>
 
 JPA 2.1 specification, section "7.6.4.1 Requirements for Persistence
 Context Propagation":
 <pre><code>
 
     If a component is called and the JTA transaction is propagated into
     that component:
 
         [..] if there is a persistence context associated with the JTA
         transaction, that persistence context is propagated and used.
 
 </code></pre></div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/8/docs/api/javax/naming/NamingException.html?is-external=true" title="class or interface in javax.naming">NamingException</a></code> - hopefully not</dd>
</dl>
</li>
</ul>
<a name="getBeanBeingTested--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getBeanBeingTested</h4>
<pre>protected final&nbsp;<a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/EntityManagerExposer.html" title="interface in com.martinandersson.javaee.jpa.entitymanagers">EntityManagerExposer</a>&nbsp;getBeanBeingTested()</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from class:&nbsp;<code><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/AbstractJTAEntityManagerTest.html#getBeanBeingTested--">AbstractJTAEntityManagerTest</a></code></span></div>
<div class="block">Returns the target bean that offer an exposed <code>EntityManager</code>.<p>
 
 One must not assume anything about the state of the entity manager's
 persistence context after this method has been called.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/AbstractJTAEntityManagerTest.html#getBeanBeingTested--">getBeanBeingTested</a></code>&nbsp;in class&nbsp;<code><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/AbstractJTAEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers">AbstractJTAEntityManagerTest</a></code></dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the target bean that offer an exposed <code>EntityManager</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ExtendedTest.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/AbstractContainerManagedEntityManagerTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers.containermanaged"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../com/martinandersson/javaee/jpa/entitymanagers/containermanaged/TransactionScopedTest.html" title="class in com.martinandersson.javaee.jpa.entitymanagers.containermanaged"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/martinandersson/javaee/jpa/entitymanagers/containermanaged/ExtendedTest.html" target="_top">Frames</a></li>
<li><a href="ExtendedTest.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2017. All rights reserved.</small></p>
</body>
</html>
