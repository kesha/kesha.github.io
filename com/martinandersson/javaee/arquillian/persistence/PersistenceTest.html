<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_92) on Fri Aug 18 15:52:08 CEST 2017 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>PersistenceTest (Java EE Concepts 1.0.0-SNAPSHOT Test API)</title>
<meta name="date" content="2017-08-18">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="PersistenceTest (Java EE Concepts 1.0.0-SNAPSHOT Test API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PersistenceTest.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/martinandersson/javaee/arquillian/persistence/Address.html" title="class in com.martinandersson.javaee.arquillian.persistence"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/martinandersson/javaee/arquillian/persistence/Person.html" title="class in com.martinandersson.javaee.arquillian.persistence"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/martinandersson/javaee/arquillian/persistence/PersistenceTest.html" target="_top">Frames</a></li>
<li><a href="PersistenceTest.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.martinandersson.javaee.arquillian.persistence</div>
<h2 title="Class PersistenceTest" class="title">Class PersistenceTest</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.martinandersson.javaee.arquillian.persistence.PersistenceTest</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">PersistenceTest</span>
extends <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block">This test case use a real database. Every time the test is executed, person
 "Donald Duck" will be created if he does not already exist, and he will be
 removed if he do exist. Therefore, you can see the actual result of these
 operations after each run directly in your NetBeans IDE.<p>
 
 
 
 <h2>The database we use</h2>
 
 This project use Java DB (also known by its legacy name "Derby") which is
 included with the JDK. You'll probably find the database here (on Windows):
 <pre><code>
 
     "C:\Program Files\Java\jdk1.8.0\db"
 
 </code></pre>
 
 NetBeans already know about this database and you may manage the database
 using the "Services" tab.<p>
 
 Note that GlassFish is bundled with his own Java DB. When you start GlassFish
 using the console ("asadmin start-domain"), GlassFish won't automatically
 start a database. You may force him to ("asadmin start-database") but that
 will make GlassFish fire up a database instance of the bundled one, not the
 JDK provided database that is integrated with NetBeans. The database
 connections we use in our tests are using the "localhost" address, so it
 doesn't matter which Java DB you use. But it is important to know which
 database you're actually using when you want to go look for the data.<p>
 
 Also note that when you start GlassFish using NetBeans, then NetBeans will
 automatically start the JDK bundled Java DB too. When using NetBeans, try to
 prefer using the IDE provided tooling for management of databases and servers
 (for Eclipse, it is the other way around).<p>
 
 
 
 <h2>How to execute</h2>
 
 Begin by having the GlassFish or WildFly server running (if you haven't
 already, read <code>HelloWorldTest.java</code> in the "helloworld" package).<p>
 
 Make sure your Java database is running. Then execute this test.<p>
 
 The rest applies to NetBeans only.<p>
 
 After you have executed the test for the first time and it successfully
 completed, go to the "Services" tab, expand "Databases" -> "Java DB". If
 you're asked for user credentials, type in username "app" and password "app".
 If that don't work, try "APP"/"APP".<p>
 
 You should see that a new database has appeared: "arquillian-test-db". If not,
 try to refresh the screen by restarting your entire IDE (and submit a feature
 request to the plugin developers that they add a menu refresh item). Once you
 see the database, right-click on it and select "connect". A new connection
 leaf should pop-up a bit further down on the screen. Something like:
 <pre><code>
 
     "jdbc:derby://localhost:1527/arquillian-test-db [ on Default schema]"
 
 </code></pre>
 
 Expand the connection leaf and continue expanding "Other schemas" ->
 "ARQUILLIAN_PERSISTENCE" -> "Tables". Right-click table "PERSON" and select
 "View Data...". You should see Donald somewhere in that table.<p>
 
 The schema "ARQUILLIAN_PERSISTENCE" has been specified using the
 <code>@Table</code> annotation on the JPA entity class <a href="../../../../../com/martinandersson/javaee/arquillian/persistence/Person.html" title="class in com.martinandersson.javaee.arquillian.persistence">Person</a>.<p>
 
 
 
 <h2>How it works</h2>
 
 The following is a short and compact rundown of how persistence configuration
 is done in Java EE. Some details are commented all over the files used in
 this package, but in no way is this test supposed to be a complete guide to
 entity configuration and management.<p>
 
 
 
 <h3>Persistence Unit</h3>
 
 Using a database require that we configure a persistence unit, which is
 provided in the file "persistence.xml". The persistence unit is a unit of
 entity configuration that says how entities are persisted. This file can
 contain multiple such configurations, we [and most applications] settle with
 just one. Two important questions answered by our configuration unit is:
 1) Which classes are JPA entities? These classes must be scanned and
 processed by the persistence provider; the implementation of the Java
 Persistence API. 2) Which data source will the provider use?<p>
 
 
 
 <h3>Data Source and JTA</h3>
 
 According to the JavaDoc of <code>javax.sql.DataSource</code>, a data source
 is<sup>1</sup>:
 
 <pre><code>
 
     A factory for connections to the physical data source that this
     DataSource object represents. [A] DataSource object is the preferred
     means of getting a connection. [..] The DataSource interface is
     implemented by a driver vendor.
 
 </code></pre>
 
 The persistence unit configuration must point to a named data source that the
 persistence provider is supposed to use.<p>
 
 The data source configuration in turn must point to a JDBC compliant driver
 which is the actual component/class used by the persistence provider for his
 database access. The data source configuration must also provide things such
 as a username and a password. It is not hard to understand that when the
 application is executed, the driver must be present on the server's
 classpath.<p>
 
 JDBC drivers are said to come in two different flavors: "XA" drivers and
 non-XA drivers (in the real world though, there will be <i>one</i> driver).
 The only difference is whether the driver support distributed transactions or
 not. XA is a popular protocol for distributed transaction processing (DTP)
 and does not originate from the Java world. XA is the protocol used for
 distributed transactions in Java EE. The Java Transaction API (JTA) is
 basically a collection of interfaces that all Java-side parties use to make
 DTP/XA come true for Java EE applications. You'll hear "JTA" or see it
 written everywhere so let me clear one minor confusion that inevitably will
 arise if it hasn't already:<p>
 
 Distributed computing in a cluster or data grid (difference being network
 locality; cluster = LAN, grid = WAN) is currently not part of Java EE and is
 vendor-specific. It might become standardized in Java EE 8 (JSR-107 and
 JSR-347). Yet we keep hearing about "distributed transactions" and probably
 every Java EE application you've seen, including this test, use this thing
 called "JTA".<p>
 
 JTA is a specification for "distributed transactions" and the specification
 itself often refer to a "global transaction". But the transaction doesn't
 necessarily have to involve two or more machines. Indeed for the vast
 majority of homebuilt Java EE applications, the active JTA transaction is
 never "distributed" across the network. The transaction is "distributed" in
 the sense that it should involve more than just one resource. In our case, we
 enlist only one transaction-aware resource; the database. So we could manage
 without JTA. Had we used more resources than so, say a JMS queue or a second
 database, then we must use a JTA transaction. However, since we want the
 application server to manage transaction boundaries for us, then we are
 required to use a JTA transaction anyways<sup>2</sup>. So JTA transactions is
 the normal case even though most applications technically speaking don't need
 one.<p>
 
 
 
 <h3>persistence.xml</h3>
 
 If you read the "persistence.xml" file, you'll find a comment that says Java
 EE 7 compliant servers provide a "default data source" so that we don't have
 to define one ourselves. Using a default data source, which is implicitly
 inferred if the data source reference is left out, make it possible for a
 Java EE developer to shrink the size of the "persistence.xml" file down to a
 minimum. But there is no "default persistence unit". So if our application
 use persistence, then we must bundle a "persistence.xml" file with our
 deployed archive and in it we must define at least one persistence unit.<p>
 
 The file must be located "in the META-INF directory of the root of the
 persistence unit"<sup>3</sup>. What exactly that translates to in English is
 well described here:
 
 <pre>
     http://docs.oracle.com/javaee/7/tutorial/persistence-intro003.htm#JEETT01162
 </pre>
 
 
 
 <h3>Data source definition</h3>
 
 We know how to define our persistence unit in the "persistence.xml" file and
 we know what goes into the configuration of a data source. But one minor
 detail is missing: Where do we define the data source, how does it come to
 life?<p>
 
 A Java SE application that use JPA can put data source configuration such
 as a username and a password as properties in the "persistence.xml" file.
 However, it isn't as easy for Java EE applications. The data source
 reference, if provided, must be put in the "persistence.xml" file. But unlike
 Java SE applications, we must configure the data source elsewhere.<p>
 
 For Java EE applications, a data source has historically been viewed as a
 server side resource. Before Java EE 6, defining a data source was a real
 hassle. One was limited to use application server GUI:s- and consoles, or use
 vendor-specific XML files such as "glassfish-resources.xml" for GlassFish, or
 "*-ds.xml" for JBoss. In reality, the developer spent an enourmous amount of
 time getting things to work. And when the time came for the developer to
 switch to another application server, he'll find himself right back where he
 started. The only thing that was portable was "configuration madness".
 Furthermore, test code that needed to temporarily define a data source in a
 flexible way had no ways of doing so.<p>
 
 Java EE 6 (JSR-250 version 1.1, section 2.13 [2.14 in version 1.2])
 introduced the <code>@DataSourceDefinition</code> annotation to alleviate these
 problems. Moreover, the umbrella specification (JSR-316 version 6.0, section
 EE.5.17 [EE.5.18.3 in version 7.0]) said that a data source configuration may
 also be put in the archive deployment descriptors ("ejb-jar.xml" and
 "web.xml", provided for your convenience and reference).<p>
 
 Note that how all this relates to the JPA bootstrap process has been left out
 from the JPA specification. And go figure, all the popular application
 servers didn't bother to look for a data source definition before actually
 parsing the "persistence.xml" file. Instead they crashed big-time,
 complaining about missing resources. Therefore the cool and new features of
 deployable data source definitions had no effect and was totally useless.
 Only the latest releases of GlassFish and WildFly has finally made the age
 old <code>@DataSourceDefinition</code> actually work as intended (well.. almost,
 see "ArquillianDS.java"). It is important to know that before you waste time
 trying to get things to work in older environments.<p>
 
 
 
 <h3>Use Arquillian and ShrinkWrap to explore!</h3>
 
 If it isn't obvious by now; configuration of a Java EE application server and
 the packaging of deployment archives is perhaps harder than figuring out how
 to design and write application code. Use Arquillian and ShrinkWrap to
 explore this wasteland. Comment statements out, change them, add annotations,
 do whatever you want to and then run the test again. Simple as that. Make use
 of this possibility.<p>
 
 
 
 <h3>Note 1</h3>
 
 For your future reference, the JDBC-, JTA- and JTS specifications all refer
 to the driver as a "resource adapter" for the "resource manager" which is the
 actual RDBMS server.
 
 
 <h3>Note 2</h3>
 If you want to know more, google "container-managed transactions" or "CMT"
 for short which is what the <code>PersonRepository</code> bean use. Also note that
 JTA is required for the <code>UserTransaction</code> interface as well (or BMT;
 bean-managed transactions). Only the <code>EntityTransaction</code> interface and
 resource-local entity managers may skip JTA completely.<p>
 
 One might not feel so great about the fact that we are forced to use
 expensive DTP/XA given that we use only one database resource. But in such
 case, modern optimizations employed by application servers can vastly reduce
 the cost (google "Logging Last Resource" (LLR) or "Last Agent Optimization"
 (LAO)).
 
 
 <h3>Note 3</h3>
 JPA 2.1, section "8.2.1 persistence.xml file".</div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>Martin Andersson (webmaster at martinandersson.com)</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../com/martinandersson/javaee/arquillian/persistence/PersistenceTest.html#PersistenceTest--">PersistenceTest</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/martinandersson/javaee/arquillian/persistence/PersistenceTest.html#createOrDeleteDonaldDuck--">createOrDeleteDonaldDuck</a></span>()</code>
<div class="block">If no Donald Duck was found, one will be created.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="PersistenceTest--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>PersistenceTest</h4>
<pre>public&nbsp;PersistenceTest()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="createOrDeleteDonaldDuck--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>createOrDeleteDonaldDuck</h4>
<pre>public&nbsp;void&nbsp;createOrDeleteDonaldDuck()</pre>
<div class="block">If no Donald Duck was found, one will be created. Otherwise, first Donald
 Duck returned from database will be massacred.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PersistenceTest.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/martinandersson/javaee/arquillian/persistence/Address.html" title="class in com.martinandersson.javaee.arquillian.persistence"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/martinandersson/javaee/arquillian/persistence/Person.html" title="class in com.martinandersson.javaee.arquillian.persistence"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/martinandersson/javaee/arquillian/persistence/PersistenceTest.html" target="_top">Frames</a></li>
<li><a href="PersistenceTest.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2017. All rights reserved.</small></p>
</body>
</html>
